<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InfraTrack Global - Infrastructure Transparency Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%231eaf75;stop-opacity:1' /><stop offset='100%' style='stop-color:%23667eea;stop-opacity:1' /></linearGradient></defs><rect width='100' height='100' rx='20' fill='url(%23grad)'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>üåç</text></svg>" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="homepagestyle.css">
</head>
<body>
    <div class="animated-bg"></div>
    <div class="grid-overlay"></div>
    
    <div class="content-wrapper">
        <!-- TOP BAR -->
        <div class="top-bar">
            <div class="logo-section">
                <button class="toggle-btn" id="menuToggle"><i class="fas fa-bars"></i></button>
                <div class="logo-icon">üåç</div>
            </div>
            
            <div class="menu-buttons" id="topMenu">
                <a href="Account.html">
                   <i class="fas fa-user"></i> <span>Account</span>
                </a>
                <a href="about.html">
                   <i class="fas fa-info-circle"></i> <span>About us</span>
                </a>
            </div>
        </div>

        <!-- HERO SECTION -->
        <div class="hero-section">
            <div class="hero-badge">‚ú® Real-Time Infrastructure Monitoring</div>
            <h1>InfraTrack Global</h1>
            <p class="tagline">Transparency & Accountability for Developing Nations</p>

            <div class="hero-stats">
                <div class="stat-item">
                    <div class="stat-number" id="stat-reports">2.4M</div>
                    <div class="stat-label">üìä Active Reports</div>
                </div>

                <div class="stat-item">
                    <div class="stat-number" id="stat-countries">15</div>
                    <div class="stat-label">üåç Countries Covered</div>
                </div>

                <div class="stat-item">
                    <div class="stat-number" id="stat-users">150K</div>
                    <div class="stat-label">üë• Active Users</div>
                </div>
            </div>
        </div>

        <!-- SERVICE SELECTOR -->
        <div class="service-selector">
            <button class="service-btn active">‚ö° Power Infrastructure</button>
            <button class="service-btn">üíß Water Supply</button>
            <button class="service-btn">üì± Internet Connectivity</button>
        </div>

        <!-- LIVE MAP SECTION -->
        <div class="map-section">
            <h3 class="section-title">
                <i class="fas fa-map-marked-alt"></i>
                Live Infrastructure Map
            </h3>
            <div class="map-placeholder">
                <p>
                    üó∫Ô∏è Interactive Global Infrastructure Map<br>
                    <span style="font-size: 0.9em; color: rgba(255,255,255,0.4);">(Google Maps Integration)</span>
                </p>
                <a href="Mapview.html">
                    <i class="fas fa-map-marker-alt"></i> Explore Map
                </a>
            </div>
        </div>

        <!-- QUICK STATS -->
        <div class="map-section" style="margin-top: 40px;">
            <h3 class="section-title">
                <i class="fas fa-chart-line"></i>
                Today's Performance Overview
            </h3>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h2>‚ö° Power Grid</h2>
                <div class="big-number" id="stat-power">87%</div>
                <p>Network Reliability</p>
            </div>

            <div class="stat-card">
                <h2>üíß Water Systems</h2>
                <div class="big-number" id="stat-water">79%</div>
                <p>Supply Consistency</p>
            </div>

            <div class="stat-card">
                <h2>üì± Internet</h2>
                <div class="big-number" id="stat-internet">92%</div>
                <p>Connection Uptime</p>
            </div>

            <div class="stat-card featured">
                <h2>üèÜ Overall Infrastructure Score</h2>
                <div class="big-number" id="stat-overall">86/100</div>
                <p>Excellent Performance</p>
            </div>
        </div>
    </div>

    <!-- BOTTOM BAR -->
    <div class="bottom-bar">
        <div class="menu-buttons">
            <a href="homepage.html">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="map.html">
                <i class="fas fa-map-marker-alt"></i> Map
            </a>
            <a href="report.html">
                <i class="fas fa-file-alt"></i> Report
            </a>
            <a href="report_feeds.html">
                <i class="fas fa-rss"></i> Report feeds
            </a>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const topMenu = document.getElementById('topMenu');

        if (window.innerWidth <= 768) {
            topMenu.classList.add('mobile-hidden');
        }

        menuToggle.addEventListener('click', function() {
            topMenu.classList.toggle('mobile-hidden');
            const icon = this.querySelector('i');
            icon.className = topMenu.classList.contains('mobile-hidden') ? 'fas fa-bars' : 'fas fa-times';
        });

        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768) {
                const isClickInsideMenu = topMenu.contains(event.target);
                const isClickOnToggle = menuToggle.contains(event.target);
                
                if (!isClickInsideMenu && !isClickOnToggle && !topMenu.classList.contains('mobile-hidden')) {
                    topMenu.classList.add('mobile-hidden');
                    menuToggle.querySelector('i').className = 'fas fa-bars';
                }
            }
        });

        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                topMenu.classList.remove('mobile-hidden');
                menuToggle.querySelector('i').className = 'fas fa-bars';
            }
        });

        // Service button interactions
        const serviceButtons = document.querySelectorAll('.service-btn');
        serviceButtons.forEach(button => {
            button.addEventListener('click', function() {
                serviceButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Parallax effect on scroll
        window.addEventListener('scroll', function() {
            const scrolled = window.pageYOffset;
            const parallax = document.querySelector('.animated-bg');
            if (parallax) {
                parallax.style.transform = `translateY(${scrolled * 0.5}px)`;
            }
        });
    </script>

    <script>
        // Collect basic performance metrics and send to backend
        (function sendMetrics() {
            function gather() {
                const perf = window.performance || null;
                const timing = perf && perf.timing ? perf.timing.toJSON ? perf.timing : Object.assign({}, perf.timing) : {};
                const navigation = perf && perf.getEntriesByType ? perf.getEntriesByType('navigation')[0] : null;
                const metrics = {
                    loadTime: navigation ? navigation.loadEventEnd - navigation.startTime : (timing.loadEventEnd && timing.navigationStart ? timing.loadEventEnd - timing.navigationStart : null),
                    domContentLoaded: timing.domContentLoadedEventEnd && timing.navigationStart ? timing.domContentLoadedEventEnd - timing.navigationStart : null,
                    firstPaint: null,
                    time: Date.now()
                };
                try {
                    const paints = perf.getEntriesByType && perf.getEntriesByType('paint') || [];
                    paints.forEach(p => {
                        if (p.name === 'first-paint') metrics.firstPaint = Math.round(p.startTime);
                        if (p.name === 'first-contentful-paint') metrics.firstContentfulPaint = Math.round(p.startTime);
                    });
                } catch (e) {}

                return metrics;
            }

            function post(m) {
                navigator.sendBeacon = navigator.sendBeacon || function(url, data) {
                    return fetch(url, { method: 'POST', body: data, credentials: 'omit', keepalive: true });
                };

                const payload = {
                    path: location.pathname,
                    metrics: m
                };

                try {
                    const blob = new Blob([JSON.stringify(payload)], { type: 'application/json' });
                    navigator.sendBeacon('http://localhost:3000/metrics', blob);
                } catch (e) {
                    fetch('http://localhost:3000/metrics', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }).catch(()=>{});
                }
            }

            window.addEventListener('load', function() {
                setTimeout(function() { post(gather()); }, 2000);
            });
            setInterval(function() { post({ time: Date.now(), heartbeat: true }); }, 60000);
        })();
    </script>

    <script>
        (function loadStats(){
            function formatNumber(n){
                if (n == null) return '--';
                if (n >= 1000000) return (n/1000000).toFixed(1) + 'M';
                if (n >= 1000) return (n/1000).toFixed(0) + 'K';
                return String(n);
            }

            fetch('http://localhost:3000/api/stats')
                .then(r => { if(!r.ok) throw new Error('network'); return r.json(); })
                .then(data => {
                    // support two shapes: { activeReports,... , } and { hero:{...}, infrastructure:{...} }
                    const hero = data.hero || data;
                    const infra = data.infrastructure || data;

                    if (hero.activeReports !== undefined) document.getElementById('stat-reports').innerText = formatNumber(hero.activeReports);
                    else if (hero.active_reports !== undefined) document.getElementById('stat-reports').innerText = formatNumber(hero.active_reports);

                    if (hero.countriesCovered !== undefined) document.getElementById('stat-countries').innerText = hero.countriesCovered;
                    else if (hero.countries_covered !== undefined) document.getElementById('stat-countries').innerText = hero.countries_covered;

                    if (hero.activeUsers !== undefined) document.getElementById('stat-users').innerText = formatNumber(hero.activeUsers);
                    else if (hero.active_users !== undefined) document.getElementById('stat-users').innerText = formatNumber(hero.active_users);

                    // infrastructure values may be strings like "87%" or numbers
                    if (infra.power !== undefined) document.getElementById('stat-power').innerText = infra.power;
                    else if (infra.power_grid && infra.power_grid.value !== undefined) document.getElementById('stat-power').innerText = formatValue(infra.power_grid);

                    if (infra.water !== undefined) document.getElementById('stat-water').innerText = infra.water;
                    else if (infra.water_systems && infra.water_systems.value !== undefined) document.getElementById('stat-water').innerText = formatValue(infra.water_systems);

                    if (infra.internet !== undefined) document.getElementById('stat-internet').innerText = infra.internet;
                    else if (infra.internet && infra.internet.value !== undefined) document.getElementById('stat-internet').innerText = formatValue(infra.internet);

                    if (infra.overall !== undefined) document.getElementById('stat-overall').innerText = infra.overall;
                    else if (infra.overall_score && infra.overall_score.value !== undefined) document.getElementById('stat-overall').innerText = formatValue(infra.overall_score);
                })
                .catch(err => {
                    console.warn('Could not load live stats:', err);
                });

            function formatValue(obj){
                if (!obj) return '--';
                const v = obj.value;
                const unit = obj.unit || '';
                if (unit === '%') return (Number(v) % 1 === 0 ? String(Number(v)) : Number(v).toFixed(1)) + unit;
                return String(v) + (unit ? (' ' + unit) : '');
            }
        })();
    </script>

</body>
</html>
